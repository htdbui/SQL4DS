<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>Introduction</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <hr>
<h2 id="title-sql-chapter-4-time-1author-db">title: &quot;SQL Chapter 4 Time 1&quot;
author: &quot;db&quot;</h2>
<h1 id="introduction">Introduction</h1>
<ul>
<li>In Chapters 2 and 3, you learned to:
<ul>
<li>Specify columns and rows to pull from a database.</li>
<li>Use the <code>WHERE</code> clause to filter rows.</li>
</ul>
</li>
<li>But what if you want a column or value based on a conditional statement?
<ul>
<li>For example, instead of filtering purchases over $50, you want to flag each purchase as above or below $50.</li>
<li>Or, you need to encode categorical strings into numeric values for a machine learning algorithm.</li>
</ul>
</li>
<li>These are called &quot;derived columns&quot; or &quot;calculated fields&quot; in SQL.
<ul>
<li>Creating new columns with different values is known as &quot;feature engineering.&quot;</li>
<li>This is where CASE statements come in.</li>
</ul>
</li>
<li>If you know &quot;if&quot; statements in languages like Python:
<ul>
<li>SQL handles conditional logic similarly.</li>
<li>It just uses different syntax.</li>
</ul>
</li>
</ul>
<h1 id="case-statement-syntax">CASE Statement Syntax</h1>
<ul>
<li>You use conditional reasoning daily.
<ul>
<li>For example: &quot;If [condition] is true, then [action]. Otherwise, [other action].&quot;</li>
</ul>
</li>
<li>In SQL, this logic is implemented using a <code>CASE</code> statement.
<ul>
<li>The syntax is as follows:</li>
</ul>
</li>
</ul>
<pre><code class="language-sql"><span class="hljs-keyword">CASE</span>
    <span class="hljs-keyword">WHEN</span> [<span class="hljs-keyword">first</span> conditional statement] 
      <span class="hljs-keyword">THEN</span> [<span class="hljs-keyword">value</span> <span class="hljs-keyword">or</span> calculation]
    <span class="hljs-keyword">WHEN</span> [<span class="hljs-keyword">second</span> conditional statement] 
      <span class="hljs-keyword">THEN</span> [<span class="hljs-keyword">value</span> <span class="hljs-keyword">or</span> calculation] 
    <span class="hljs-keyword">ELSE</span> [<span class="hljs-keyword">value</span> <span class="hljs-keyword">or</span> calculation]
<span class="hljs-keyword">END</span>
</code></pre>
<ul>
<li>This statement assigns different values to a column based on conditions.
<ul>
<li>For example: &quot;If it will rain today, then I'll take an umbrella. Otherwise, I'll leave it at home.&quot;</li>
</ul>
</li>
</ul>
<pre><code class="language-sql"><span class="hljs-keyword">CASE</span>
    <span class="hljs-keyword">WHEN</span> weather_forecast <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;rain&#x27;</span>
      <span class="hljs-keyword">THEN</span> <span class="hljs-string">&#x27;take umbrella&#x27;</span>
    <span class="hljs-keyword">ELSE</span> <span class="hljs-string">&#x27;leave umbrella at home&#x27;</span>
<span class="hljs-keyword">END</span>
</code></pre>
<ul>
<li>The <code>WHEN</code> conditions are evaluated from top to bottom.
<ul>
<li>The <code>ELSE</code> part is optional.</li>
<li>If not included, the result will be <code>NULL</code> if no conditions evaluate to <code>TRUE</code>.</li>
</ul>
</li>
<li>To illustrate, consider this query:</li>
</ul>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span>
    <span class="hljs-keyword">CASE</span>
        <span class="hljs-keyword">WHEN</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">&#x27;Yes&#x27;</span>
        <span class="hljs-keyword">WHEN</span> <span class="hljs-number">2</span><span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">&#x27;No&#x27;</span>
    <span class="hljs-keyword">END</span>
</code></pre>
<ul>
<li>This query will always evaluate to &quot;Yes&quot; because <code>1=1</code> is always <code>TRUE</code>.</li>
<li>The <code>2=2</code> conditional statement is never evaluated, even though it is also true.</li>
<li>You should always alias columns with <code>CASE</code> statements for readability.
<ul>
<li>In SQL, &quot;aliasing columns&quot; means giving a column a temporary name using the <code>AS</code> keyword.</li>
</ul>
</li>
<li>The following figure shows the vendor types in the Farmer's Market database:</li>
</ul>
<p><img src="file:///c:\Users\tuand\OneDrive - stud.uni-goettingen.de\Attachments\Github\SQL4DS\Fotos\Chapter4\Fig_4.1.png" alt="Figure 4.1"></p>
<figcaption></figcaption>
<ul>
<li>Let's label vendors primarily selling fresh produce.
<ul>
<li>Vendors with &quot;Fresh&quot; in the <code>vendor_type</code> column are labeled as &quot;Fresh Produce.&quot;</li>
<li>Others are labeled as &quot;Other.&quot;</li>
</ul>
</li>
</ul>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span>
    vendor_id,
    vendor_name,
    vendor_type,
    <span class="hljs-keyword">CASE</span>
        <span class="hljs-keyword">WHEN</span> <span class="hljs-built_in">LOWER</span>(vendor_type) <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%fresh%&#x27;</span>
          <span class="hljs-keyword">THEN</span> <span class="hljs-string">&#x27;Fresh Produce&#x27;</span>
        <span class="hljs-keyword">ELSE</span> <span class="hljs-string">&#x27;Other&#x27;</span>
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> vendor_type_condensed <span class="hljs-comment">-- Alias the column</span>
<span class="hljs-keyword">FROM</span> farmers_market.vendor
</code></pre>
<p><img src="file:///c:\Users\tuand\OneDrive - stud.uni-goettingen.de\Attachments\Github\SQL4DS\Fotos\Chapter4\Fig_4.2.png" alt="Figure 4.2"></p>
<figcaption></figcaption>
<ul>
<li>The <code>LOWER()</code> function is used to lowercase the <code>vendor_type</code> string for comparison.
<ul>
<li>The <code>UPPER()</code> function could also be used if the comparison string is all caps like <code>'%FRESH%'</code>.</li>
</ul>
</li>
<li>If a new vendor type containing the word &quot;fresh&quot; is added to the database:
<ul>
<li>The query using the <code>LIKE</code> comparison will automatically categorize it as &quot;Fresh Produce&quot; in the <code>vendor_type_condensed</code> column.</li>
</ul>
</li>
<li>To restrict the labeling to existing vendor types:
<ul>
<li>Use the <code>IN</code> keyword and explicitly list the vendor types to be labeled as &quot;Fresh Produce.&quot;</li>
</ul>
</li>
<li>As a data analyst or data scientist:
<ul>
<li>Consider how changes in the underlying data might affect your transformed columns when building a dataset that may be refreshed with new data.</li>
</ul>
</li>
</ul>
<h1 id="creating-binary-flags-using-case">Creating Binary Flags Using CASE</h1>
<ul>
<li>A <code>CASE</code> statement can create a &quot;binary flag field&quot; containing 1s or 0s.
<ul>
<li>For example, the Farmer's Markets in the database occur on Wednesday evenings or Saturday mornings.</li>
<li>This is illustrated in the following figure:</li>
</ul>
</li>
</ul>
<p><img src="file:///c:\Users\tuand\OneDrive - stud.uni-goettingen.de\Attachments\Github\SQL4DS\Fotos\Chapter4\Fig_4.3.png" alt="Figure 4.3"></p>
<figcaption></figcaption>
<ul>
<li>To convert the <code>market_day</code> string column into a binary flag field indicating weekday or weekend markets:
<ul>
<li>Include &quot;Sunday&quot; in the OR statement, even though our farmer's markets currently occur on Wednesday evenings and Saturday mornings.</li>
<li>Name the field <code>weekend_flag</code> instead of <code>saturday_flag</code> to account for potential future markets on Sundays.</li>
<li>This way, the <code>CASE</code> statement will still correctly flag it as a weekend market if the schedule changes.</li>
<li>This approach ensures the field name accurately reflects its purpose.</li>
<li>It also prepares for future changes with minimal additional computation.</li>
</ul>
</li>
</ul>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span>
    market_date,
    <span class="hljs-keyword">CASE</span>
        <span class="hljs-keyword">WHEN</span> market_day <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Saturday&#x27;</span> <span class="hljs-keyword">OR</span> market_day <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Sunday&#x27;</span>
          <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span>
        <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> weekend_flag
<span class="hljs-keyword">FROM</span> farmers_market.market_date_info
LIMIT <span class="hljs-number">5</span>
</code></pre>
<p><img src="file:///c:\Users\tuand\OneDrive - stud.uni-goettingen.de\Attachments\Github\SQL4DS\Fotos\Chapter4\Fig_4.4.png" alt="Figure 4.4"></p>
<figcaption></figcaption>
<h1 id="grouping-or-binning-continuous-values-using-case">Grouping or Binning Continuous Values Using CASE</h1>
<ul>
<li>In Chapter 3, we filtered customer purchases over $50 using the <code>WHERE</code> clause.</li>
<li>To return all rows and indicate whether the cost was over $50, we can use this query:</li>
</ul>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span>
    market_date,
    customer_id,
    vendor_id,
    ROUND(quantity <span class="hljs-operator">*</span> cost_to_customer_per_qty, <span class="hljs-number">2</span>) <span class="hljs-keyword">AS</span> price,
    <span class="hljs-keyword">CASE</span>
        <span class="hljs-keyword">WHEN</span> quantity <span class="hljs-operator">*</span> cost_to_customer_per_qty <span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span>
          <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span>
        <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> price_over_50
<span class="hljs-keyword">FROM</span> farmers_market.customer_purchases
LIMIT <span class="hljs-number">10</span>
</code></pre>
<p><img src="file:///c:\Users\tuand\OneDrive - stud.uni-goettingen.de\Attachments\Github\SQL4DS\Fotos\Chapter4\Fig_4.5.png" alt="Figure 4.5"></p>
<figcaption></figcaption>
<ul>
<li><code>CASE</code> statements can also &quot;bin&quot; continuous variables like price.</li>
<li>To group line-item customer purchases into price bins:</li>
</ul>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span>
    market_date,
    customer_id,
    vendor_id,
    ROUND(quantity <span class="hljs-operator">*</span> cost_to_customer_per_qty, <span class="hljs-number">2</span>) <span class="hljs-keyword">AS</span> price,
    <span class="hljs-keyword">CASE</span>
        <span class="hljs-keyword">WHEN</span> quantity <span class="hljs-operator">*</span> cost_to_customer_per_qty <span class="hljs-operator">&lt;</span> <span class="hljs-number">5.00</span>
          <span class="hljs-keyword">THEN</span> <span class="hljs-string">&#x27;Under $5&#x27;</span>
        <span class="hljs-keyword">WHEN</span> quantity <span class="hljs-operator">*</span> cost_to_customer_per_qty <span class="hljs-operator">&lt;</span> <span class="hljs-number">10.00</span>
          <span class="hljs-keyword">THEN</span> <span class="hljs-string">&#x27;$5-$9.99&#x27;</span>
        <span class="hljs-keyword">WHEN</span> quantity <span class="hljs-operator">*</span> cost_to_customer_per_qty <span class="hljs-operator">&lt;</span> <span class="hljs-number">20.00</span>
          <span class="hljs-keyword">THEN</span> <span class="hljs-string">&#x27;$10-$19.99&#x27;</span>
        <span class="hljs-keyword">WHEN</span> quantity <span class="hljs-operator">*</span> cost_to_customer_per_qty <span class="hljs-operator">&gt;=</span> <span class="hljs-number">20.00</span>
          <span class="hljs-keyword">THEN</span> <span class="hljs-string">&#x27;$20 and Up&#x27;</span>
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> price_bin
<span class="hljs-keyword">FROM</span> farmers_market.customer_purchases
LIMIT <span class="hljs-number">10</span>
</code></pre>
<p><img src="file:///c:\Users\tuand\OneDrive - stud.uni-goettingen.de\Attachments\Github\SQL4DS\Fotos\Chapter4\Fig_4.6.png" alt="Figure 4.6"></p>
<figcaption></figcaption>
<ul>
<li>To output the bottom end of the numeric range for the bins:</li>
</ul>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span>
    market_date,
    customer_id,
    vendor_id,
    ROUND(quantity <span class="hljs-operator">*</span> cost_to_customer_per_qty, <span class="hljs-number">2</span>) <span class="hljs-keyword">AS</span> price,
    <span class="hljs-keyword">CASE</span>
        <span class="hljs-keyword">WHEN</span> quantity <span class="hljs-operator">*</span> cost_to_customer_per_qty <span class="hljs-operator">&lt;</span> <span class="hljs-number">5.00</span>
          <span class="hljs-keyword">THEN</span> <span class="hljs-number">0</span>
        <span class="hljs-keyword">WHEN</span> quantity <span class="hljs-operator">*</span> cost_to_customer_per_qty <span class="hljs-operator">&lt;</span> <span class="hljs-number">10.00</span>
          <span class="hljs-keyword">THEN</span> <span class="hljs-number">5</span>
        <span class="hljs-keyword">WHEN</span> quantity <span class="hljs-operator">*</span> cost_to_customer_per_qty <span class="hljs-operator">&lt;</span> <span class="hljs-number">20.00</span>
          <span class="hljs-keyword">THEN</span> <span class="hljs-number">10</span>
        <span class="hljs-keyword">WHEN</span> quantity <span class="hljs-operator">*</span> cost_to_customer_per_qty <span class="hljs-operator">&gt;=</span> <span class="hljs-number">20.00</span>
          <span class="hljs-keyword">THEN</span> <span class="hljs-number">20</span>
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> price_bin_lower_end
<span class="hljs-keyword">FROM</span> farmers_market.customer_purchases
LIMIT <span class="hljs-number">10</span>
</code></pre>
<p><img src="file:///c:\Users\tuand\OneDrive - stud.uni-goettingen.de\Attachments\Github\SQL4DS\Fotos\Chapter4\Fig_4.7.png" alt="Figure 4.7"></p>
<figcaption></figcaption>
<ul>
<li>One query generates a new column of strings.</li>
<li>The other generates a new column of numbers.</li>
<li>Including both columns in your query can be useful for reports:
<ul>
<li>The <code>price_bin</code> column provides explanatory labels but sorts alphabetically.</li>
<li>The numeric column sorts bins correctly.</li>
</ul>
</li>
<li>Without an <code>ELSE</code> in the <code>CASE</code> statement:
<ul>
<li>The output will be <code>NULL</code> if the quantity field is blank or the calculation fails.</li>
</ul>
</li>
<li>If a price is mis-entered or a refund is recorded:
<ul>
<li>Negative values will fall into the &quot;Under $5&quot; or 0 bin.</li>
<li>This makes <code>price_bin_lower_end</code> a misnomer.</li>
</ul>
</li>
<li>Ensure your <code>CASE</code> statements handle unexpected values appropriately.</li>
</ul>
<h1 id="categorical-encoding-using-case">Categorical Encoding Using CASE</h1>
<ul>
<li>Machine learning datasets often require encoding categorical string variables as numeric values.</li>
<li>If the categories represent a rank order:
<ul>
<li>Convert the string variables into numeric values representing that order.</li>
</ul>
</li>
<li>For example:
<ul>
<li>The vendor booth price levels labeled &quot;A,&quot; &quot;B,&quot; and &quot;C&quot; can be converted into numeric values 1, 2, 3.</li>
</ul>
</li>
<li>The following <code>CASE</code> statement converts booth price levels into numeric values:</li>
</ul>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> 
    booth_number,
    booth_price_level, 
    <span class="hljs-keyword">CASE</span> 
        <span class="hljs-keyword">WHEN</span> booth_price_level <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;A&#x27;</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> 
        <span class="hljs-keyword">WHEN</span> booth_price_level <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;B&#x27;</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">2</span> 
        <span class="hljs-keyword">WHEN</span> booth_price_level <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;C&#x27;</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">3</span>
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> booth_price_level_numeric 
<span class="hljs-keyword">FROM</span> farmers_market.booth
LIMIT <span class="hljs-number">5</span>
</code></pre>
<p><img src="file:///c:\Users\tuand\OneDrive - stud.uni-goettingen.de\Attachments\Github\SQL4DS\Fotos\Chapter4\Fig_4.8.png" alt="Figure 4.8"></p>
<figcaption></figcaption>
<ul>
<li>If categories have no rank order, like vendor types:
<ul>
<li>Use &quot;one-hot encoding.&quot;
<ul>
<li>This creates a new column for each category.
<ul>
<li>Assign a binary value of 1 if a row falls into that category.</li>
<li>Assign a binary value of 0 otherwise.</li>
</ul>
</li>
<li>These columns are called &quot;dummy variables.&quot;</li>
</ul>
</li>
</ul>
</li>
<li>The following <code>CASE</code> statement one-hot encodes vendor type categories:</li>
</ul>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> 
    vendor_id,
    vendor_name, 
    vendor_type, 
    <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> vendor_type <span class="hljs-operator">=</span>  <span class="hljs-string">&#x27;Arts &amp; Jewelry&#x27;</span> 
        <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span>
        <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> 
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> vendor_type_arts_jewelry,
    <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> vendor_type <span class="hljs-operator">=</span>  <span class="hljs-string">&#x27;Eggs &amp; Meats&#x27;</span> 
        <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span>
        <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> 
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> vendor_type_eggs_meats,
    <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> vendor_type <span class="hljs-operator">=</span>  <span class="hljs-string">&#x27;Fresh Focused&#x27;</span> 
        <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span>
        <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> 
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> vendor_type_fresh_focused,  
    <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> vendor_type <span class="hljs-operator">=</span>  <span class="hljs-string">&#x27;Fresh Variety: Veggies &amp; More&#x27;</span> 
        <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span>
        <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> 
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> vendor_type_fresh_variety,
    <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> vendor_type <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Prepared Foods&#x27;</span> 
        <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span>
        <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> 
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> vendor_type_prepared 
<span class="hljs-keyword">FROM</span> farmers_market.vendor
</code></pre>
<p><img src="file:///c:\Users\tuand\OneDrive - stud.uni-goettingen.de\Attachments\Github\SQL4DS\Fotos\Chapter4\Fig_4.9.png" alt="Figure 4.9"></p>
<figcaption></figcaption>
<ul>
<li>When manually encoding one-hot categorical variables:
<ul>
<li>If a new category is added (e.g., a new vendor type):
<ul>
<li>There will be no column for the new category until you add another <code>CASE</code> statement.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="case-statement-summary">CASE Statement Summary</h1>
<ul>
<li>
<p>In this chapter, you learned SQL <code>CASE</code> statement syntax for creating new columns with values based on conditions.</p>
</li>
<li>
<p>You also learned how to:</p>
<ul>
<li>Consolidate categorical values.</li>
<li>Create binary flags.</li>
<li>Bin continuous values.</li>
<li>Encode categorical values.</li>
</ul>
</li>
<li>
<p>You should now be able to describe what the following two queries do.</p>
</li>
<li>
<p>Query 1:</p>
</li>
</ul>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> 
    customer_id,
    <span class="hljs-keyword">CASE</span> 
        <span class="hljs-keyword">WHEN</span> customer_zip <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;22801&#x27;</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">&#x27;Local&#x27;</span> 
        <span class="hljs-keyword">ELSE</span> <span class="hljs-string">&#x27;Not Local&#x27;</span> 
    <span class="hljs-keyword">END</span> customer_location_type 
<span class="hljs-keyword">FROM</span> farmers_market.customer 
LIMIT <span class="hljs-number">10</span>
</code></pre>
<p><img src="file:///c:\Users\tuand\OneDrive - stud.uni-goettingen.de\Attachments\Github\SQL4DS\Fotos\Chapter4\Fig_4.10.png" alt="Figure 4.10"></p>
<figcaption></figcaption>
<ul>
<li>Query 2:</li>
</ul>
<pre><code class="language-sql"><span class="hljs-keyword">SELECT</span> 
    booth_number,
    <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> booth_price_level <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;A&#x27;</span> 
        <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> 
        <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> 
    <span class="hljs-keyword">END</span> booth_price_level_A,
    <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> booth_price_level <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;B&#x27;</span> 
        <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> 
        <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> 
    <span class="hljs-keyword">END</span> booth_price_level_B,
    <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> booth_price_level <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;C&#x27;</span> 
        <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> 
        <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> 
    <span class="hljs-keyword">END</span> booth_price_level_C 
<span class="hljs-keyword">FROM</span> farmers_market.booth 
LIMIT <span class="hljs-number">5</span>
</code></pre>
<p><img src="file:///c:\Users\tuand\OneDrive - stud.uni-goettingen.de\Attachments\Github\SQL4DS\Fotos\Chapter4\Fig_4.11.png" alt="Figure 4.11"></p>
<h1 id="excercises">Excercises</h1>
<ul>
<li>Look back at Figure 2.1 in Chapter 2 for sample data and column names for the <code>product</code> table referenced in these exercises.</li>
</ul>
<ol>
<li>
<p>Products can be sold individually or in bulk (e.g., lbs or oz).</p>
<ul>
<li>Write a query that outputs the <code>product_id</code> and <code>product_name</code> columns from the <code>product</code> table.</li>
<li>Add a column called <code>prod_qty_type_condensed</code> that displays &quot;unit&quot; if <code>product_qty_type</code> is &quot;unit,&quot; and &quot;bulk&quot; otherwise.</li>
</ul>
</li>
<li>
<p>Flag all types of pepper products sold at the market.</p>
<ul>
<li>Add a column to the previous query called <code>pepper_flag</code> that outputs 1 if <code>product_name</code> contains the word &quot;pepper&quot; (case-insensitive), and 0 otherwise.</li>
</ul>
</li>
<li>
<p>Can you think of a situation where a pepper product might not be flagged as a pepper product using the code from the previous exercise?</p>
</li>
</ol>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            
        </body>
        </html>